enum RequestState {
  IN_PROGRESS,
  CANCELLED,
  COMPLETED
}

type Job @entity(immutable: false) {
  id: ID!
  metadata: String!
  owner: Bytes!
  provider: Bytes!
  rate: BigInt!
  balance: BigInt!
  lastSettled: BigInt!
  totalDeposit: BigInt!
  refund: BigInt! # only updated on job close
  createdAt: BigInt!
  endAt: BigInt!
  rateRevisionHistory: [ReviseRateRequest!]! @derivedFrom(field: "job")
  settlementHistory: [SettlementHistory!]! @derivedFrom(field: "job")
  depositHistory: [DepositHistory!]! @derivedFrom(field: "job")
}

type SettlementHistory @entity(immutable: true) {
  id: ID!
  job: Job!
  timestamp: BigInt!
  amount: BigInt!
  txHash: Bytes!
}

type DepositHistory @entity(immutable: true) {
  id: ID!
  job: Job!
  timestamp: BigInt!
  amount: BigInt!
  isWithdrawal: Boolean!
  txHash: Bytes!
}

type ReviseRateRequest @entity(immutable: false) {
  id: ID!
  job: Job!
  updatesAt: BigInt!
  status: RequestState!
  value: BigInt!
}

type Provider @entity(immutable: false) {
  id: ID! #id same as owner address
  cp: String
  live: Boolean
}

type LockTime @entity(immutable: false) {
  id: ID!
  value: BigInt!
}

# Config to store EXTRA_DECIMALS (global values)
type Config @entity(immutable: false) {
  id: ID!
  value: BigInt!
}